{% comment %}
  Memorial Stories Wall Block - Component-Based Architecture
  Displays memorial wall with filters and submission form using reusable components
{% endcomment %}

{% schema %}
{
  "name": "Stories Wall",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Memorial Wall"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Road violence doesn't just take lives, it shatters the lives of survivors and families. Together, these walls show the full impact."
    },
    {
      "type": "text",
      "id": "form_heading",
      "label": "Form Section Heading",
      "default": "Have you or someone you love been impacted by traffic violence?"
    },
    {
      "type": "text",
      "id": "form_subheading",
      "label": "Form Section Subheading",
      "default": "Honor their memory. Share their story. Share their story."
    },
    {
      "type": "range",
      "id": "initial_load",
      "label": "Initial stories to load",
      "min": 6,
      "max": 24,
      "step": 6,
      "default": 12
    },
    {
      "type": "textarea",
      "id": "us_states",
      "label": "US States (one per line)",
      "default": "Alabama\nAlaska\nArizona\nArkansas\nCalifornia\nColorado\nConnecticut\nDelaware\nFlorida\nGeorgia\nHawaii\nIdaho\nIllinois\nIndiana\nIowa\nKansas\nKentucky\nLouisiana\nMaine\nMaryland\nMassachusetts\nMichigan\nMinnesota\nMississippi\nMissouri\nMontana\nNebraska\nNevada\nNew Hampshire\nNew Jersey\nNew Mexico\nNew York\nNorth Carolina\nNorth Dakota\nOhio\nOklahoma\nOregon\nPennsylvania\nRhode Island\nSouth Carolina\nSouth Dakota\nTennessee\nTexas\nUtah\nVermont\nVirginia\nWashington\nWest Virginia\nWisconsin\nWyoming",
      "info": "Enter one state per line. These will be used in both the filter dropdown and submission form."
    },
    {
      "type": "text",
      "id": "contact_email",
      "label": "Contact Email",
      "default": "contact@example.com",
      "info": "Email address for the 'Email Us' button in the submission form"
    }
  ]
}
{% endschema %}
{% assign base_url = 'https://stories-app.fly.dev/' %}
<div class="memorial-page-container">
  <!-- Header with Stats Component - 3 Categories -->
  {% render 'header-stats',
    heading: block.settings.heading,
    description: block.settings.description
  %}

  <!-- Content Wrapper -->
  <div class="memorial-content-wrapper">
    <!-- Lives Stolen Section -->
    {% render 'story-section',
      section_id: 'lives-stolen-section',
      section_title: 'Lives Stolen',
      injury_type: 'Fatal',
      grid_id: 'lives-stolen-grid',
      filter_id: 'lives-stolen-filter',
      see_all_id: 'lives-stolen-see-all',
      us_states: block.settings.us_states
    %}

    <!-- Lives Shattered Section -->
    {% render 'story-section',
      section_id: 'lives-shattered-section',
      section_title: 'Lives Shattered',
      injury_type: 'Non-fatal',
      grid_id: 'lives-shattered-grid',
      filter_id: 'lives-shattered-filter',
      see_all_id: 'lives-shattered-see-all',
      us_states: block.settings.us_states
    %}

    <!-- Lives Forever Changed Section -->
    {% render 'story-section',
      section_id: 'lives-changed-section',
      section_title: 'Lives Forever Changed',
      injury_type: 'Not-hit',
      grid_id: 'lives-changed-grid',
      filter_id: 'lives-changed-filter',
      see_all_id: 'lives-changed-see-all',
      us_states: block.settings.us_states
    %}
  </div>

  <!-- Submit Story Form Section -->
 
</div>
<section class="memorial-form-section-wrapper" id="submit-story">
  <div class="memorial-form-section-header">
    <h2 class="memorial-form-section-title">{{ block.settings.form_heading }}</h2>
    <p class="memorial-form-section-subtitle">{{ block.settings.form_subheading }}</p>
  </div>

  <!-- Form Container -->
  <div class="memorial-form-container-wrapper">
    <!-- Submission Form Component -->
    {% render 'submission-form',
      us_states: block.settings.us_states,
      form_id: 'memorial-submission-form',
      contact_email: block.settings.contact_email
    %}

    <!-- Success Message Component -->
    {% render 'success-message',
      success_id: 'memorial-form-success',
      title: 'Thank You!',
      message: 'Your submission has been received. We appreciate you sharing this story.',
      button_text: 'OK',
      button_action: 'location.reload()'
    %}
  </div>
</section>



<!-- Load CSS from app -->
<link rel="stylesheet" href="{{ base_url }}assets/memorial-stories.css">

<!-- Load JavaScript from app -->
<script src="{{ base_url }}assets/memorial-stories.js" defer></script>

<script>
  window.MEMORIAL_SETTINGS = {
    initialLoad: {{ block.settings.initial_load }},
    apiBaseUrl: "{{ base_url }}",
    shop: "{{ shop.permanent_domain }}"
  };
</script>
