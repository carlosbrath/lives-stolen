{% comment %}
  Memorial Story Submission Form Block - Component-Based Architecture
  Allows visitors to submit their memorial stories using reusable components
{% endcomment %}

{% schema %}
{
  "name": "Story Form",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Share Your Story"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Have you or someone you love been impacted by traffic violence?"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "textarea",
      "id": "us_states",
      "label": "US States (one per line)",
      "default": "Alabama\nAlaska\nArizona\nArkansas\nCalifornia\nColorado\nConnecticut\nDelaware\nFlorida\nGeorgia\nHawaii\nIdaho\nIllinois\nIndiana\nIowa\nKansas\nKentucky\nLouisiana\nMaine\nMaryland\nMassachusetts\nMichigan\nMinnesota\nMississippi\nMissouri\nMontana\nNebraska\nNevada\nNew Hampshire\nNew Jersey\nNew Mexico\nNew York\nNorth Carolina\nNorth Dakota\nOhio\nOklahoma\nOregon\nPennsylvania\nRhode Island\nSouth Carolina\nSouth Dakota\nTennessee\nTexas\nUtah\nVermont\nVirginia\nWashington\nWest Virginia\nWisconsin\nWyoming",
      "info": "Enter one state per line for the state dropdown."
    }
  ]
}
{% endschema %}

<div class="memorial-form-section" style="background-color: {{ block.settings.background_color }}; color: {{ block.settings.text_color }};">
  <div class="memorial-form-container">
    <!-- Form Header -->
    <div class="memorial-form-header">
      <h2 class="memorial-form-title">{{ block.settings.heading }}</h2>
      <p class="memorial-form-description">{{ block.settings.description }}</p>
    </div>

    <!-- Submission Form Component -->
    {% render 'submission-form',
      us_states: block.settings.us_states,
      form_id: 'memorial-submission-form'
    %}

    <!-- Success Message Component -->
    {% render 'success-message',
      success_id: 'memorial-form-success',
      title: 'Thank You!',
      message: 'Your submission has been received. We appreciate you sharing this story.',
      button_text: 'Submit Another Story',
      button_action: 'location.reload()'
    %}
  </div>
</div>

{% assign base_url = 'https://stories-app.fly.dev/' %}


<!-- Load CSS and JS from app -->
<link rel="stylesheet" href="{{ base_url }}assets/memorial-stories.css">
<script src="{{ base_url }}assets/memorial-stories.js" defer></script>

<script>
  // Set up shop domain for API
  window.MEMORIAL_SETTINGS = {
    shop: "{{ shop.permanent_domain }}",
    apiBaseUrl: '{{ base_url }}'
  };
</script>

<style>
  .memorial-form-section {
    padding: 80px 20px;
    min-height: 600px;
  }

  .memorial-form-container {
    max-width: 900px;
    margin: 0 auto;
  }

  .memorial-form-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .memorial-form-title {
    font-size: 2.5rem;
    font-weight: 900;
    margin: 0 0 16px 0;
  }

  .memorial-form-description {
    font-size: 1.15rem;
    margin: 0;
    opacity: 0.9;
  }

  @media (max-width: 768px) {
    .memorial-form-title {
      font-size: 2rem;
    }
  }
</style>
