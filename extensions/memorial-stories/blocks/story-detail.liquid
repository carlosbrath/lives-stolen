{% comment %}
  Memorial Story Detail Block
  Displays a single memorial story with full details using StoryDetailManager component
  Usage: Add to a page template and pass story ID via URL parameter
{% endcomment %}

{% schema %}
{
  "name": "Story Detail",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "back_link_text",
      "label": "Back Link Text",
      "default": "Back to Memorial Wall"
    },
    {
      "type": "text",
      "id": "back_link_url",
      "label": "Back Link URL",
      "default": "/pages/memorial-wall",
      "info": "Enter a relative path (e.g., /pages/memorial-wall) or full URL"
    }
  ]
}
{% endschema %}

<div class="memorial-detail-page">
  <div id="memorial-detail-container" class="memorial-detail">
    <!-- Story details will be loaded here by StoryDetailManager -->
    <div class="memorial-loading">
      <div class="memorial-loading__spinner"></div>
      <p>Loading story...</p>
    </div>
  </div>
</div>


{% assign base_url = 'https://stories-app.fly.dev/' %}

<!-- Load CSS and JS from app -->
<link rel="stylesheet" href="{{ base_url }}assets/memorial-stories.css">
<script src="{{ base_url }}assets/memorial-stories.js" defer></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('memorial-detail-container');

    // Get story ID from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const storyId = urlParams.get('id') || window.location.pathname.split('/').pop();

    if (!storyId) {
      container.innerHTML = '<div class="memorial-error"><p>No story ID provided.</p></div>';
      return;
    }

    // Initialize StoryDetailManager component
    new StoryDetailManager({
      apiBaseUrl: '{{ base_url }}',
      storyId: storyId,
      backLinkUrl: '{{ block.settings.back_link_url }}',
      backLinkText: '{{ block.settings.back_link_text }}',
      container: container
    });
  });
</script>

<style>
  .memorial-detail-page {
    background: #ffffff;
    min-height: 100vh;
    padding: 20px 0;
  }

  @media (max-width: 768px) {
    .memorial-detail-page {
      padding: 10px 0;
    }
  }
</style>
