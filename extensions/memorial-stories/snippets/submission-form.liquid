{% comment %}
  Submission Form Component
  Reusable story submission form

  Parameters:
  - us_states: List of states (from settings)
  - form_id: ID for the form (default: 'memorial-submission-form')
  - contact_email: Email address for the Email Us button (default: 'contact@example.com')
{% endcomment %}

{% assign form_id = form_id | default: 'memorial-submission-form' %}
{% assign contact_email = contact_email | default: 'contact@example.com' %}
{% assign base_url = 'https://stories-app.fly.dev/' %}
<form id="{{ form_id }}" class="memorial-form" method="post" onsubmit="return false;">
  <!-- Submitter Info -->
  <div class="memorial-form-row">
    <div class="memorial-form-group">
      <label for="submitterName">Submitter Name *</label>
      <input type="text" id="submitterName" name="submitterName" required>
    </div>
  </div>

  <div class="memorial-form-row">
    <div class="memorial-form-group">
      <label for="submitterEmail">Submitter Email *</label>
      <input type="email" id="submitterEmail" name="submitterEmail" required>
    </div>
  </div>

  <!-- Victim Info -->
  <div class="memorial-form-row">
    <div class="memorial-form-group">
      <label for="victimName">Victim Name</label>
      <input type="text" id="victimName" name="victimName">
    </div>
  </div>

  <!-- Incident Details: Date | Zip | State -->
  <div class="memorial-form-row memorial-form-row-3cols">
    <div class="memorial-form-group">
      <label for="incidentDate">Incident Date *</label>
      <input type="date" id="incidentDate" name="incidentDate" required>
    </div>
    <div class="memorial-form-group">
      <label for="zipCode">Zip Code</label>
      <input type="text" id="zipCode" name="zipCode" placeholder="Zip code">
    </div>
    <div class="memorial-form-group">
      <label for="state">State *</label>
      <div class="memorial-searchable-select" id="state-select-container">
        <input type="hidden" id="state" name="state" required>
        <div class="memorial-searchable-select-trigger" id="state-select-trigger">
          <span class="memorial-searchable-select-value" id="state-select-value">Select a state...</span>
          <svg class="memorial-searchable-select-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="memorial-searchable-select-dropdown" id="state-select-dropdown" style="display: none;">
          <div class="memorial-searchable-select-search">
            <input type="text" class="memorial-searchable-select-input" id="state-search-input" placeholder="Search states..." autocomplete="off">
          </div>
          <div class="memorial-searchable-select-options" id="state-options-list">
            {% assign states_string = us_states | newline_to_br | split: '<br />' %}
            {% for state in states_string %}
              {% assign trimmed_state = state | strip %}
              {% if trimmed_state != blank %}
                <div class="memorial-searchable-select-option" data-value="{{ trimmed_state }}">{{ trimmed_state }}</div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Road User Type | Injury Type -->
  <div class="memorial-form-row memorial-form-row-3cols">
    <div class="memorial-form-group">
      <label for="roadUserType">Road User Type *</label>
      <select id="roadUserType" name="roadUserType" required>
        <option value="">Select type</option>
        <option value="Cyclist">Cyclist</option>
        <option value="Pedestrian">Pedestrian</option>
        <option value="Motorcyclist">Motorcyclist</option>
      </select>
    </div>
    <div class="memorial-form-group">
      <label>Injury Type (Fatal/Non-fatal) *</label>
      <div class="memorial-radio-group">
        <label class="memorial-radio-label">
          <input type="radio" name="injuryType" value="Fatal" required>
          <span>Fatal</span>
        </label>
        <label class="memorial-radio-label">
          <input type="radio" name="injuryType" value="Non-fatal" required>
          <span>Non-fatal</span>
        </label>
        <label class="memorial-radio-label">
          <input type="radio" name="injuryType" value="Not-hit" required>
          <span>Not hit, but deeply impacted</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Age | Gender -->
  <div class="memorial-form-row memorial-form-row-3cols">
    <div class="memorial-form-group">
      <label for="age">Age at Incident</label>
      <input type="number" id="age" name="age" min="0" max="120" placeholder="Enter age">
    </div>
    <div class="memorial-form-group">
      <label>Gender</label>
      <div class="memorial-radio-group">
        <label class="memorial-radio-label">
          <input type="radio" name="gender" value="Male">
          <span>Male</span>
        </label>
        <label class="memorial-radio-label">
          <input type="radio" name="gender" value="Female">
          <span>Female</span>
        </label>
        <label class="memorial-radio-label">
          <input type="radio" name="gender" value="Other">
          <span>Other</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Story -->
  <div class="memorial-form-group">
    <label for="victimStory">Tell Their Story *</label>
    <textarea
      id="victimStory"
      name="victimStory"
      rows="8"
      required
      placeholder="Share the story of your loved one..."
    ></textarea>
  </div>

  <!-- Photo Upload -->
  <div class="memorial-form-group">
    <label for="photo-upload">Photos (optional, max 10)</label>
    <div class="memorial-upload-container">
      <input
        type="file"
        id="photo-upload"
        name="photos"
        accept="image/*"
        multiple
        class="memorial-file-input"
      >
      <div class="memorial-upload-area" id="upload-area">
        <img src="{{ base_url }}assets/images/browse.png" style="width:200px; height:110px " width="100" height="100" alt="Browse to upload images" class="memorial-browse-image">
        <p class="memorial-upload-count" id="upload-count">0 / 10 images</p>
      </div>
      <div class="memorial-preview-grid" id="preview-grid"></div>
      <div class="memorial-upload-error" id="upload-error" style="display: none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
        <div class="memorial-upload-error-content">
          <strong>Upload Error</strong>
          <p id="upload-error-message"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Contact Preference -->
  <div class="memorial-form-group">
    <label>Interested in being contacted about your story?</label>
    <div class="memorial-radio-group">
      <label class="memorial-radio-label">
        <input type="radio" name="interestedInContact" value="yes">
        <span>Yes, contact me</span>
      </label>
      <label class="memorial-radio-label">
        <input type="radio" name="interestedInContact" value="no">
        <span>No</span>
      </label>
    </div>
  </div>

  <!-- Error Display -->
  <div class="memorial-form-error" id="form-error" style="display: none;"></div>

  <!-- Submit Buttons -->
  <div class="memorial-button-group">
    <button type="submit" class="memorial-form-submit" id="submit-button">
      <span class="submit-text">Submit</span>
      <span class="submit-loading" style="display: none;">Submitting...</span>
    </button>
    {% comment %} <a href="mailto:{{ contact_email }}" class="memorial-email-button">Email Us</a> {% endcomment %}
  </div>
</form>
